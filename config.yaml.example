# ============================================
# Speedtest Monitor Configuration
# ============================================

# Operation mode
# Options: single, master, node
# - single: Run speedtest and send notification directly (default)
# - master: Collect results from nodes and send aggregated report
# - node: Run speedtest and send results to master
mode: single

# ============================================
# Master Mode Configuration
# ============================================
master:
  listen_host: "0.0.0.0"
  listen_port: 8080
  
  # Shared secret token. MUST be the same on Master and all Nodes.
  # Generate with: openssl rand -hex 32
  api_token: "CHANGE_ME_SHARED_SECRET_TOKEN"
  
  # Scheduling configuration
  schedule:
    # Minimum interval between aggregated reports (minutes)
    # If send_immediately is false, reports will be sent at this interval.
    interval_minutes: 60
    
    # If true: Send a report immediately every time a node sends a result.
    # If false: Aggregate results and send once per interval_minutes.
    # Recommended: false (to avoid spam)
    send_immediately: false
  
  # Time after which a node is considered offline (minutes)
  node_timeout_minutes: 120

  # Order of nodes in the report (determines sorting)
  nodes_order: []  # optional; if empty or missing, nodes are sorted by node_id alphabetically

  # Metadata for nodes (flags, display names)
  # Keys (fin, lv, etc.) must match 'node_id' in Node configs
  nodes_meta:
    example-fi:
      flag: "üá´üáÆ"
      display_name: "Finland node #1"
    example-de:
      flag: "üá©üá™"
      display_name: "Germany node #1"

  # Telegram recipients for aggregated reports
  telegram_targets:
    - chat_id: 123456789
      default_language: "ru"      # ru | en
      default_view_mode: "detailed" # compact | detailed

# ============================================
# Node Mode Configuration
# ============================================
node:
  node_id: "fin"  # Must match key in master's nodes_meta
  description: "Finland Node"
  
  # URL to reach the Master API
  # Examples:
  # - Public IP: http://1.2.3.4:8080/api/v1/report
  # - Domain:    http://monitor.example.com:8080/api/v1/report
  # - Local LAN: http://192.168.1.100:8080/api/v1/report
  master_url: "http://YOUR_MASTER_IP:8080/api/v1/report"
  
  # Shared secret token. MUST match the one in Master config.
  api_token: "CHANGE_ME_SHARED_SECRET_TOKEN"

# ============================================
# Single Mode / Common Configuration
# ============================================

# Server identification
# Use "auto" for automatic detection or set manually
server:
  # Server name (hostname if "auto")
  name: "auto"
  
  # Server location (IP geolocation if "auto")
  location: "auto"
  
  # Unique server identifier (hostname if "auto")
  identifier: "auto"
  
  # Custom description for this server
  description: "Production Web Server #1"

# Speedtest configuration
speedtest:
  # Timeout for speedtest execution (seconds)
  timeout: 90
  
  # Specific speedtest server IDs (empty = auto-select best server)
  # Find servers: speedtest-cli --list
  servers: []
  
  # Number of retry attempts if speedtest fails
  retry_count: 3
  
  # Delay between retry attempts (seconds)
  retry_delay: 5

# Speed thresholds (Mbps)
# Adjust based on your server type and expected speeds
thresholds:
  # Below this = üö® Very Low
  very_low: 50
  
  # Between very_low and this = ‚ö†Ô∏è Low
  low: 200
  
  # Between low and this = ‚úÖ Normal
  medium: 500
  
  # Above medium = üöÄ Excellent
  good: 1000

# Telegram notification settings
telegram:
  # Bot token is loaded from TELEGRAM_BOT_TOKEN environment variable (.env file)
  
  # Chat IDs for notifications (REQUIRED - at least one!)
  # Replace with your actual Telegram chat ID(s)
  # For personal messages, use your user_id here
  # Get it: @userinfobot or https://api.telegram.org/bot<TOKEN>/getUpdates
  chat_ids:
    - "YOUR_CHAT_ID_HERE"
  
  # Check interval in seconds (3600 = 1 hour, 1800 = 30 min, 7200 = 2 hours)
  check_interval: 3600
  
  # Send notifications even when speed is good
  # true = always send, false = only when speed is low or errors
  send_always: true
  
  # Message format: "html" or "markdown"
  format: "html"

  # Language for notifications (ru/en)
  language: "ru"

  # Message style for Single Mode (compact/detailed)
  # - compact: Short one-line summary
  # - detailed: Full report with server info and ping
  message_style: "detailed"

# Logging configuration
logging:
  # Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
  level: "INFO"
  
  # Log file path (relative or absolute)
  file: "speedtest.log"
  
  # When to rotate log file (size or time based)
  # Examples: "10 MB", "1 day", "1 week", "monday"
  rotation: "10 MB"
  
  # How long to keep old log files
  # Examples: "1 week", "1 month", "3 months"
  retention: "1 week"

# ============================================
# Configuration Examples by Server Type
# ============================================

# Web Server (high traffic):
# thresholds: {very_low: 100, low: 500, medium: 1000, good: 2000}

# Database Server (stability important):
# thresholds: {very_low: 50, low: 200, medium: 500, good: 1000}
# telegram: {send_always: true}

# CDN/Edge Server (maximum speed):
# thresholds: {very_low: 500, low: 1000, medium: 2000, good: 5000}

# Office Server (normal requirements):
# thresholds: {very_low: 25, low: 100, medium: 300, good: 500}

# Home Server:
# thresholds: {very_low: 10, low: 50, medium: 100, good: 200}

# ============================================
# Status Configuration (Optional)
# ============================================
status_config:
  # Statuses used in SINGLE-NODE telegram notifications
  single_node_statuses:
    very_low:
      emoji: "üö®‚ùå"
      label:
        en: "Very Low"
        ru: "–û—á–µ–Ω—å –Ω–∏–∑–∫–æ"
    low:
      emoji: "‚ö†Ô∏èüêå"
      label:
        en: "Low"
        ru: "–ù–∏–∑–∫–æ"
    normal:
      emoji: "‚úÖüöó"
      label:
        en: "Normal"
        ru: "–ù–æ—Ä–º–∞–ª—å–Ω–æ"
    good:
      emoji: "üëçüõú"
      label:
        en: "Good"
        ru: "–•–æ—Ä–æ—à–æ"
    excellent:
      emoji: "üöÄ‚ö°"
      label:
        en: "Excellent"
        ru: "–û—Ç–ª–∏—á–Ω–æ"

  # Statuses used in aggregated master reports
  aggregated_statuses:
    ok:
      emoji: "‚úÖ"
      label:
        en: "Good"
        ru: "–•–æ—Ä–æ—à–æ"
    degraded:
      emoji: "‚ö†Ô∏è"
      label:
        en: "Degraded"
        ru: "–ü—Ä–æ—Å–∞–¥–∫–∞"
