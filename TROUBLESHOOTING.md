# üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å speedtest

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. "Cannot retrieve speedtest configuration ERROR: timed out"

**–û–ø–∏—Å–∞–Ω–∏–µ**: speedtest-cli –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–µ—Ä–≤–µ—Ä–æ–≤

**–†–µ—à–µ–Ω–∏—è**:

#### –ê. –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç
```yaml
# config.yaml
speedtest:
  timeout: 180  # 3 –º–∏–Ω—É—Ç—ã
```

#### –ë. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
```yaml
speedtest:
  server_id: 9644  # ID —Å–µ—Ä–≤–µ—Ä–∞ (—Å–º. –ø–æ–ª—É—á–µ–Ω–∏–µ ID –Ω–∏–∂–µ)
```

#### –í. –í–∫–ª—é—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```yaml
speedtest:
  test_mode: true  # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ ID —Å–µ—Ä–≤–µ—Ä–æ–≤

```bash
# –ù–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à–∏–µ —Å–µ—Ä–≤–µ—Ä—ã
speedtest-cli --list | head -20

# –ü–æ–∏—Å–∫ –ø–æ –≥–æ—Ä–æ–¥—É
speedtest-cli --list | grep Moscow
speedtest-cli --list | grep "Saint Petersburg"

# –ß–µ—Ä–µ–∑ API (–µ—Å–ª–∏ speedtest-cli –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
curl -s "https://www.speedtest.net/api/js/servers?engine=js" | jq '.[0:10]'
```

**–ü—Ä–∏–º–µ—Ä—ã —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è –†–æ—Å—Å–∏–∏**:
- `9644` - Saint Petersburg (Forest Net)
- `4975` - Moscow (MTS)
- `5705` - Moscow (Rostelecom)

### 3. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã speedtest

```bash
# –¢–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–∫–∞ (–±—ã—Å—Ç—Ä–µ–µ)
speedtest-cli --simple --no-upload

# –ü—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–∞—Ç –±–µ–∑ JSON
speedtest-cli --simple

# –° –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º
speedtest-cli --server 9644 --simple
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

### –ù–∞–¥–µ–∂–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```yaml
# config.yaml
speedtest:
  timeout: 180           # –ë–æ–ª—å—à–æ–π —Ç–∞–π–º–∞—É—Ç
  retry_count: 5         # –ë–æ–ª—å—à–µ –ø–æ–ø—ã—Ç–æ–∫
  server_id: 9644        # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
  test_mode: false       # –†–µ–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
telegram:
  send_always: false
```

### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ cron —Å —É—á–µ—Ç–æ–º –Ω–∞–≥—Ä—É–∑–∫–∏

```bash
# –ò–∑–±–µ–≥–∞–µ–º –ø–∏–∫–æ–≤—ã—Ö —á–∞—Å–æ–≤ (19-23)
# –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–æ—á—å—é –∏ —É—Ç—Ä–æ–º
0 2,6,10,14 * * * cd /path/to/project && python main.py
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### 1. –í–∫–ª—é—á–∏—Ç—å DEBUG –ª–æ–≥–∏

```yaml
# config.yaml
logging:
  level: "DEBUG"
```

### 2. –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
python diagnose.py
```

### 3. –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ speedtest

```bash
# –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
speedtest-cli --simple

# JSON —Å —Ç–∞–π–º–∞—É—Ç–æ–º
speedtest-cli --json --timeout 60

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
speedtest-cli --server 9644 --simple
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏

```bash
# –ü–∏–Ω–≥ speedtest.net
ping -c 3 speedtest.net

# –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
nslookup speedtest.net

# –¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
curl -I https://speedtest.net
```

## üîÑ Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### 1. –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º

–î–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º:

```python
# –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ cron —Å–∫—Ä–∏–ø—Ç–µ
if ! python main.py; then
    echo "–†–µ–∞–ª—å–Ω—ã–π speedtest –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤–∫–ª—é—á–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º"
    sed -i 's/test_mode: false/test_mode: true/' config.yaml
    python main.py
    sed -i 's/test_mode: true/test_mode: false/' config.yaml
fi
```

### 2. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤
brew install speedtest  # –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Ookla Speedtest
pip install speedtest-cli-py

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
speedtest --format=json  # –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç—ã

### –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
#!/bin/bash
# check_speedtest.sh

LOG_FILE="speedtest.log"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫
LAST_SUCCESS=$(grep "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ" $LOG_FILE | tail -1)
LAST_ERROR=$(grep "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–∞–º–∏" $LOG_FILE | tail -1)

if [[ -z "$LAST_SUCCESS" ]]; then
    echo "‚ö†Ô∏è –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–ª–æ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤"
elif [[ "$LAST_ERROR" > "$LAST_SUCCESS" ]]; then
    echo "‚ùå –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫ –±—ã–ª –Ω–µ—É—Å–ø–µ—à–Ω—ã–º"
    echo "–í–∫–ª—é—á–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º..."
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
else
    echo "‚úÖ –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫ –±—ã–ª —É—Å–ø–µ—à–Ω—ã–º"
fi
```

## üåç –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü—Ä–æ–±–ª–µ–º—ã —Å DNS
```bash
# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–∏–µ DNS
echo "nameserver 8.8.8.8" > /etc/resolv.conf
echo "nameserver 1.1.1.1" >> /etc/resolv.conf
```

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∫—Å–∏
```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–∫—Å–∏
unset http_proxy https_proxy
```

### 3. –§–∞–π—Ä–≤–æ–ª
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–æ–≤ speedtest
telnet speedtest.net 80
telnet speedtest.net 443
```

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä** - –∞–≤—Ç–æ–≤—ã–±–æ—Ä –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–∞—Ç—å
2. **–£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã** - –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ retry** - –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –æ—à–∏–±–æ–∫
5. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è** - —Å–µ—Ä–≤–µ—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω—ã
6. **–ò–º–µ–π—Ç–µ fallback –ø–ª–∞–Ω** - —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

---

üí° **–°–æ–≤–µ—Ç**: –ù–∞—á–Ω–∏—Ç–µ —Å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ (`test_mode: true`), —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ –∑–∞—Ç–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞–π—Ç–µ—Å—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã.